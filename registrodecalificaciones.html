<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Registro de Calificaciones</title>
</head>
<body>

  <h1>Registro de Calificaciones con Estadísticas</h1>

  <label>Nombre del estudiante:</label><br>
  <input type="text" id="nombre" autocomplete="off"><br><br>

  <label>Nota (0-10):</label><br>
  <input type="number" id="nota" min="0" max="10" step="0.1"><br><br>

  <button onclick="agregarEstudiante()">Agregar estudiante</button>
  <button onclick="calcularEstadisticas()">Calcular estadísticas</button>
  <button onclick="vaciarLista()">Vaciar lista</button>

  <h3>Estudiantes registrados (<span id="contador">0</span>):</h3>
  <div id="lista"></div>

  <h3>Resultados:</h3>
  <div id="estadisticas"></div>

  <script>
    // Arreglos para guardar datos
    const nombres = [];
    const notas = [];

    // Agregar estudiante con validaciones
    function agregarEstudiante() {
      const nombreInput = document.getElementById("nombre");
      const notaInput = document.getElementById("nota");

      const nombre = nombreInput.value.trim();
      const notaVal = notaInput.value.trim();

      if (nombre === "") {
        alert("Ingresa el nombre del estudiante.");
        nombreInput.focus();
        return;
      }

      if (notaVal === "") {
        alert("Ingresa la nota del estudiante.");
        notaInput.focus();
        return;
      }

      const nota = parseFloat(notaVal);
      if (isNaN(nota) || nota < 0 || nota > 10) {
        alert("La nota debe ser un número entre 0 y 10.");
        notaInput.focus();
        return;
      }

      // Añadir a los arreglos
      nombres.push(nombre);
      notas.push(nota);

      // Limpiar campos
      nombreInput.value = "";
      notaInput.value = "";
      nombreInput.focus();

      mostrarLista();
    }

    // Mostrar lista con botones para eliminar o editar 
    function mostrarLista() {
      const listaDiv = document.getElementById("lista");
      listaDiv.innerHTML = "";

      for (let i = 0; i < nombres.length; i++) {
        // Cada entrada muestra índice, nombre, nota y botones
        const entry = document.createElement("div");
        entry.innerHTML =
          (i + 1) + ". " + nombres[i] + " - Nota: " + notas[i].toFixed(1) +
          " " +
          `<button onclick="eliminarEstudiante(${i})">Eliminar</button>` +
          ` <button onclick="editarEstudiante(${i})">Editar</button>`;
        listaDiv.appendChild(entry);
      }

      document.getElementById("contador").textContent = nombres.length;
      // Limpiar resultados mostrados si la lista cambió
      document.getElementById("estadisticas").innerHTML = "";
    }

    // Eliminar estudiante por índice
    function eliminarEstudiante(index) {
      if (!confirm("¿Eliminar a " + nombres[index] + " (nota: " + notas[index].toFixed(1) + ")?")) return;
      nombres.splice(index, 1);
      notas.splice(index, 1);
      mostrarLista();
    }

    // Editar estudiante: rellena los inputs para modificar y elimina la entrada antigua
    function editarEstudiante(index) {
      document.getElementById("nombre").value = nombres[index];
      document.getElementById("nota").value = notas[index];
      // quitar la entrada antigua para que al "Agregar" se reemplace
      nombres.splice(index, 1);
      notas.splice(index, 1);
      mostrarLista();
      document.getElementById("nombre").focus();
    }

    // Vaciar toda la lista
    function vaciarLista() {
      if (!confirm("¿Vaciar toda la lista de estudiantes?")) return;
      nombres.length = 0;
      notas.length = 0;
      mostrarLista();
    }

    // Calcular estadísticas: promedio, nota más alta (y todos los que tengan esa nota), porcentaje aprobados
    function calcularEstadisticas() {
      const estadDiv = document.getElementById("estadisticas");

      if (notas.length === 0) {
        alert("No hay estudiantes registrados.");
        return;
      }

      let suma = 0;
      let mayor = notas[0];

      for (let i = 0; i < notas.length; i++) {
        suma += notas[i];
        if (notas[i] > mayor) mayor = notas[i];
      }

      // Encontrar todos los nombres con la nota mayor (para manejar empates)
      const nombresMayor = [];
      for (let i = 0; i < notas.length; i++) {
        if (Math.abs(notas[i] - mayor) < 1e-9) {
          nombresMayor.push(nombres[i]);
        }
      }

      // Contar aprobados (nota >= 7)
      let aprobados = 0;
      for (let i = 0; i < notas.length; i++) {
        if (notas[i] >= 7) aprobados++;
      }

      const promedio = suma / notas.length;
      const porcentaje = (aprobados / notas.length) * 100;

      let texto = "";
      texto += "Promedio general: " + promedio.toFixed(2) + "<br>";
      texto += "Nota más alta: " + mayor.toFixed(1) + " (" + nombresMayor.join(", ") + ")<br>";
      texto += "Aprobados: " + aprobados + " / " + notas.length + " = " + porcentaje.toFixed(2) + "%<br>";

      estadDiv.innerHTML = texto;
    }

    // Inicializar foco
    document.getElementById("nombre").focus();
  </script>

</body>
</html>
